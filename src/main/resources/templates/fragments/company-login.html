<!-- fragments/company-login.html -->
<div th:fragment="companyLogin">
  <section class="container" style="margin-top: 120px; max-width: 560px;">
    <div class="card shadow-sm rounded-4 p-4">
      <h4 class="fw-bold mb-3 text-center">업체 로그인</h4>
      <p class="text-muted small text-center mb-4">아이디와 비밀번호로 로그인하세요.</p>

      <form id="companyLoginForm" class="needs-validation" novalidate>
        <div class="mb-3">
          <label for="username" class="form-label">아이디</label>
          <input type="text" class="form-control" id="username" placeholder="yourid" required>
          <div class="invalid-feedback">아이디를 입력하세요.</div>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">비밀번호</label>
          <input type="password" class="form-control" id="password" required>
          <div class="invalid-feedback">비밀번호를 입력하세요.</div>
        </div>
        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary"
            onclick="(async function(e){
              e.preventDefault();
              const form=document.getElementById('companyLoginForm');
              const u=document.getElementById('username')?.value?.trim();
              const p=document.getElementById('password')?.value||'';
              if(!u||!p){ form.classList.add('was-validated'); return; }
              try{
                const res = await fetch('/api/auth/login', {
                  method:'POST',
                  headers:{'Content-Type':'application/json'},
                  body: JSON.stringify({username:u, password:p}),
                  credentials:'same-origin'
                });
                const data = await res.json().catch(()=>null);
                if(!res.ok){
                  const msg = data?.message || data?.error || ('오류 코드 ' + res.status);
                  throw new Error(msg);
                }
                alert(data?.message || '로그인에 성공했습니다.');
                const dashboardUrl = data?.username
                  ? '/fragments/company-dashboard?companyName=' + encodeURIComponent(data.username)
                  : '/fragments/company-dashboard';
                loadPage(e, dashboardUrl);
              }catch(err){
                alert('로그인 실패: ' + err.message);
              }
            })(event)">로그인</button>
        </div>
      </form>
      <div class="text-center mt-3 small text-muted">
        계정이 없으신가요? <a href="#" onclick="loadPage(event, '/fragments/auth-register')">회원가입</a>
      </div>
    </div>
  </section>
</div>

<!-- 제출 처리는 main.html의 공통 submit 핸들러가 담당합니다. -->
