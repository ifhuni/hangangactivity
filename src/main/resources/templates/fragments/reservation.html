<!-- fragments/reservation.html -->
<div th:fragment="reservation" style="background-color:#0d6efd">
  <div class="container-fluid mt-5">
    <div class="row">

      <!-- 좌측 사이드바 + 검색조건 -->
      <div class="col-xl-3 col-lg-4 mb-4">
        <div class="position-sticky" style="top: 100px;">
          <div class="card shadow-sm p-3">
            <h5 class="mb-3">검색 조건</h5>

            <!-- 지역 선택 -->
            <div class="mb-3">
              <label class="form-label d-block">지역</label>
              <select id="regionSelectSide" class="form-select form-select-sm" th:value="${param.region}">
                <option value="">전체</option>
                <option value="광진구" th:selected="${param.region} == '광진구'">광진구</option>
                <option value="강남구" th:selected="${param.region} == '강남구'">강남구</option>
                <option value="마포구" th:selected="${param.region} == '마포구'">마포구</option>
                <option value="송파구" th:selected="${param.region} == '송파구'">송파구</option>
                <option value="영등포구" th:selected="${param.region} == '영등포구'">영등포구</option>
              </select>
            </div>

            <!-- 날짜 범위 -->
            <div class="mb-3">
              <label class="form-label">날짜</label>
              <div class="input-group input-group-sm">
                <input type="date" id="dateStartSide" class="form-control" th:value="${param.dateStart}">
                <span class="input-group-text">~</span>
                <input type="date" id="dateEndSide" class="form-control" th:value="${param.dateEnd}">
              </div>
            </div>

            <!-- 활동 유형 -->
            <div class="mb-3">
              <label class="form-label d-block">활동 유형</label>
              <select id="activityTypeSide" class="form-select form-select-sm" th:value="${param.activityType}">
                <option value="">전체</option>
                <option value="수상" th:selected="${param.activityType} == '수상'">수상</option>
                <option value="지상" th:selected="${param.activityType} == '지상'">지상</option>
                <option value="공중" th:selected="${param.activityType} == '공중'">공중</option>
              </select>
            </div>

            <div class="d-grid">
              <button class="btn btn-primary btn-sm"
                onclick="(function(e){
                  e.preventDefault();
                  var r=document.getElementById('regionSelectSide')?.value||'';
                  var ds=document.getElementById('dateStartSide')?.value||'';
                  var de=document.getElementById('dateEndSide')?.value||'';
                  var ty=document.getElementById('activityTypeSide')?.value||'';
                  var params=[];
                  if(r) params.push('region='+encodeURIComponent(r));
                  if(ds) params.push('dateStart='+encodeURIComponent(ds));
                  if(de) params.push('dateEnd='+encodeURIComponent(de));
                  if(ty) params.push('activityType='+encodeURIComponent(ty));
                  var url='/fragments/reservation'+(params.length?('?'+params.join('&')):'');
                  loadPage(e, url);
                })(event)">검색</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 중앙 리스트 영역 -->
      <div class="col-xl-6 col-lg-7 px-3">
        <section class="bg-light rounded-4 shadow-sm px-4 py-4"
          style="height: calc(100vh - 100px); display: flex; flex-direction: column; margin-top: 50px;">

          <!-- 헤더바 -->
          <div style="flex: 0 0 auto; position: sticky; top: 0; background: #ffffff; padding-top: 10px; padding-bottom: 10px; z-index: 10; border-bottom: 1px solid #dee2e6;">
            <h4 class="fw-bold mb-0">예약 가능한 활동</h4>
          </div>

          <!-- 예약 리스트 -->
          <div style="flex: 1 1 auto; overflow-y: auto; margin-top: 10px;">
            <div class="row g-3">
              <!-- DB 활동 리스트 -->
              <div class="col-12" th:if="${#lists.isEmpty(activities)}">
                <div class="text-muted text-center py-5">표시할 활동이 없습니다.</div>
              </div>
              <div class="col-12" th:each="act : ${activities}">
                <div class="card border-0 shadow-sm rounded-3 p-2" style="background-color: #ffffff;">
                  <div class="row g-0 align-items-center">
                    <div class="col-auto">
                      <img src="/img/climb_1.jpg" alt="활동 썸네일" class="rounded-2" style="width: 80px; height: 80px; object-fit: cover;">
                    </div>
                    <div class="col px-3">
                      <h6 class="mb-1 fw-semibold" th:text="${act.title}">활동 제목</h6>
                      <div class="small text-muted d-flex flex-wrap gap-3">
                        <span><strong>위치:</strong> <span th:text="${act.location}">위치</span></span>
                        <span><strong>날짜:</strong> <span th:text="${act.activityDate}">2025-08-01</span></span>
                      </div>
                    </div>
                    <div class="col-auto px-2">
                      <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#reservationModal">예약</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 추가 카드 필요시 여기에 -->

            </div>
          </div>
        </section>
      </div>

      <!-- 우측 여백 -->
      <div class="col-xl-3 d-none d-xl-block"></div>

      <!-- 예약 모달 -->
      <div class="modal fade" id="reservationModal" tabindex="-1" aria-labelledby="reservationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content rounded-4">
            <div class="modal-header">
              <h5 class="modal-title fw-bold" id="reservationModalLabel">예약하기</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
            </div>
            <div class="modal-body">
              <form id="reservationForm">
                <!-- 이름 -->
                <div class="mb-3">
                  <label for="name" class="form-label">이름</label>
                  <input type="text" class="form-control" id="name" required>
                </div>

                <!-- 여권번호 -->
                <div class="mb-3">
                  <label for="passport" class="form-label">여권번호</label>
                  <input type="text" class="form-control" id="passport" required>
                </div>

                <!-- 이메일 -->
                <div class="mb-3">
                  <label for="email" class="form-label">이메일</label>
                  <div class="input-group">
                    <input type="email" class="form-control" id="email" required>
                    <button type="button" class="btn btn-outline-secondary" id="sendCodeBtn">인증코드 전송</button>
                  </div>
                </div>

                <!-- 인증코드 -->
                <div class="mb-3">
                  <label for="emailCode" class="form-label">인증코드</label>
                  <input type="text" class="form-control" id="emailCode" required>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
              <button type="submit" form="reservationForm" class="btn btn-primary">예약 완료</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<style>
  .list-group-item:hover { background-color: #eef4ff !important; }
  .form-select-sm, .input-group-sm > .form-control { font-size: .9rem; }
</style>

